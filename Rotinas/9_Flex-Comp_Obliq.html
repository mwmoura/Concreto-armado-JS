<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flexo-Compressão</title>
    <style>

    @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');


        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body{
            display: flex;
        }
        #secao1{
            flex:6;
            text-align: center;
            margin-right: 2px;
            margin-left: 2px;   
        }
        #ctnexterno{
            flex:4;
            text-align: center;
            border-radius: 10px;
            box-shadow: 7px 6px 8px 5px rgba(0,0,0,0.75);
            margin-top:5px;
            margin-right: 10px;
            margin-bottom: 5px;
            
        }
        #tabela1{
            margin-left: auto;
            margin-right: auto;
            border-spacing: 0px 0px;
            box-shadow: rgba(0, 0, 0, 0.8) 2px 2px 5px 2px;
        }
        tbody>tr:nth-child(even) {
        background-color: rgba(170, 173, 196, 0.4);
        }
       
        tbody>tr:nth-child(odd) {
        background-color: rgb(94, 148, 193);
        }
        #grafico1{
            text-align: center;
        }
        #myChart{
            margin: 0 auto;
        }
        thead>tr{
            align-items: center;
            
        }

        thead>tr>td{
            font-weight: bold;
            border: 1px black solid; 
            padding-bottom: 5px;
            padding-left: 5px;
            padding-right: 5px;
        }
        
        td{
            padding-top: 5px;
            padding-bottom: 5px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            padding-left: 2px;
            padding-right: 2px;
            font-size: 12px;
            
            
        }
        h1{
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            color:rgb(36, 10, 121);
            padding-top: 15px;
            font-size: 18px;
            padding-bottom: 30px;
            text-shadow: rgb(0, 0, 0) 1px 1px;
        }
        h2{
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            text-align: center;
            color:rgb(106, 106, 106);
            padding-top: 15px;
            padding-bottom: 12px;
            text-shadow: rgba(0, 0, 0, 0.6) .5px .5px;
        }
        input[type=number] {
            width: 60px;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            text-align: center;
        }
        canvas#crosssection{
            margin: 0 auto;
            border: 1px solid black;
        }
        #myChart{
            min-width: 500px;
            
            
        }     
        
        input[type=button]{
            margin: 30px;
            padding: 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 12px;
            border-radius: 5px;
            transition: all 0.3s ease 0s;
            cursor: pointer;
            border:1px solid #052057;   
            font-weight: bold;
        }

        input[type=button]:hover{
        background-color: #05113d;
        color: #ffffff;
        }

        #creditos{
            font-family: 'Montserrat', sans-serif; 
            text-align: left;
            margin-left: 5px
            
        }
        #autores{
            display: flex;
            
        }
        .rec{
            width: 5px;
            height: 50px;
            margin-right:5px;
            background-color: rgb(10, 10, 95);
        }
        h3{
            margin-bottom: 5px;
        }
        #autor1{
            flex:1;
            
        }
        #autor2{
            flex:1;
        }
        #autor3{
            flex:1;
        }
        p{
            margin-top: 5px;
            font-size: 14px;
        }
        .titulo{
            margin-bottom: 10px;
            font-size: 12px;
        }

        @media (max-width: 1000px)
        {
        body{
            display:block;
            
        }
        #secao1{
            display: block;
            text-align: center;   
            margin-left: 10px;
            margin-right: 10px;
        }
        #ctnexterno{
            display: block;
            text-align: center;
            margin-top: 30px;
            margin-left: 5px;
            margin-bottom: 10px;
            
        }
        #myChart{
            max-width:none;
            min-width:300px;
        } 
        #autores{
            display: block;
        }
        .rec{
            display: none;
        }

    }


        
    </style>
</head>
<body>
    
    <div id="secao1">
        <h1>Flexo-Compressão Oblíqua</h1>
        <table id="tabela1">
            <thead>
            
                <td>Informação</td>
                <td>Valor</td>
                <td>Unidade</td>
            
            </thead>
            <tbody>
                <tr>
                    <td class="info" >Número de vértices da seção de concreto</td>
                    <td class="valor"><input type="number" name="nc" id="nc" oninput="addelemento()"></td>
                    <td class="unidade">---</td>
                </tr>

                <tr>
                    <td class="info" >Área de aço da seção</td>
                    <td class="valor"><input type="number" name="astotal" id="astotal"></td>
                    <td class="unidade"> cm² </td>
                </tr>

                <tr>
                    <td class="info" >Número de barras</td>
                    <td class="valor"><input type="number" name="ns" id="ns" oninput="addelemento2()"></td>
                    <td class="unidade"> --- </td>
                </tr>

                <tr>
                    <td class="info" >Resistência Caracterísitica do Concreto à Compressão</td>
                    <td class="valor"><input type="number" name="fck" id="fck">
                    <td class="unidade"> MPa </td>
                </tr>

                <tr>
                    <td class="info" >Tensão de escoamento característica do aço </td>
                    <td class="valor"><input type="number" name="fyk" id="fyk"></td>
                    <td class="unidade">MPa</td>
                </tr>

                <tr>
                    <td class="info" >Módulo de Elasticidade do Aço</td>
                    <td class="valor"><input type="number" name="esm" id="esm">
                    <td class="unidade"> GPa </td>
                </tr>

                <tr>
                    <td class="info" >Coeficientes parciais de segurança para o concreto</td>
                    <td class="valor"><input type="number" name="gamac" id="gamac"></td>
                    <td class="unidade"> --- </td>
                </tr>

                <tr>
                    <td class="info" >Coeficientes parciais de segurança para o aço</td>
                    <td class="valor"><input type="number" name="gamas" id="gamas"></td>
                    <td class="unidade"> --- </td>
                </tr>

                <tr>
                    <td class="info" >Coeficientes de majoração do esforço solicitante</td>
                    <td class="valor"><input type="number" name="gamaf" id="gamaf"></td>
                    <td class="unidade"> --- </td>
                </tr>


                <tr>
                    <td class="info" >Esforço normal característico</td>
                    <td class="valor"><input type="number" name="nsk" id="nsk">
                    <td class="unidade"> kN </td>
                </tr>

                <tr>
                    <td class="info" >Momento Fletor em torno de y</td>
                    <td class="valor"><input type="number" name="mxsk" id="mxsk">
                    <td class="unidade"> kN.cm </td>
                </tr>

                <tr>
                    <td class="info" >Momento Fletor em torno de x</td>
                    <td class="valor"><input type="number" name="mysk" id="mysk">
                    <td class="unidade"> kN.cm </td>
                </tr>
            </tbody>
        </table>
        <div id="conteinerbotao">
            <input type="button" value="Calcular" onclick="calcular()"> 
        </div>
    

        <div id="creditos">
            <h3>Desenvolvedores:</h3>
            <div id="autores">
                <div class="rec"></div>
                <div id="autor1">
                    <p>Mauro de Vasconcellos Real</p>
                    <p class="titulo">Professor EE - FURG</p>
                </div>
                <div class="rec"></div>
                <div id="autor2">
                    <p>Márcio Wrague Moura
                    <p class="titulo">Professor EE - FURG</p>
                </div>
                <div class="rec"></div>
                <div id="autor3">
                <p>Bruno Teixeira Santos</p>
                <p class="titulo">Acadêmico EE - FURG</p>
                </div>
            </div>
        </div>
    </div>
    
    

    <div id="ctnexterno">
        <div id="conteiner1">
            <h2>Seção tranversal</h2>
            <canvas id ="crosssection"></canvas>
        </div>
        <div id="grafico1">
            <h2>Diagrama de Interação</h2>
            <canvas id="myChart" ></canvas>
        </div>
    </div>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>   
<script>

function addelemento() {
    //Elimina elementos do número de vertices quando troca os dados
    let verifica = !!document.getElementById('xvertice1');
    if(verifica ==true){
        var contar = 2;
    }
    while(!!document.getElementById('xvertice'+contar)==true){
        contar++;
    }
    for(let numdelete = 0; numdelete<2*(contar-1); numdelete++){
        document.getElementById('tabela1').deleteRow(2);
    }
        
    let tabela = document.getElementById('tabela1');
    let numvertices = document.getElementById('nc').value;
    let repeticoes = numvertices;
        
    //Acrecenta novos dados para tabela referente ao eixo x e y dos vértices

    for (let contador=0;contador<repeticoes;contador++){

        let novalinha1 = tabela.insertRow(2); //Inserindo a nova linha na posição 2 da tabela
        let novalinha2 = tabela.insertRow(2);
        let novacoluna1 = novalinha1.insertCell(0); //Inserindo as colunas
        let novacoluna2 = novalinha1.insertCell(1);
        let novacoluna3 = novalinha1.insertCell(2);
        let novacoluna4 = novalinha2.insertCell(0);
        let novacoluna5 = novalinha2.insertCell(1);
        let novacoluna6 = novalinha2.insertCell(2);
        let novoinput1 =[]; //Declarando o input como array
        let novoinput2=[];
        novoinput1[contador] = document.createElement("input"); // Criando os inputs
        novoinput2[contador] = document.createElement("input");
        novoinput1[contador].type = "number"; //Falando que os input tem tipo número
        novoinput2[contador].type = "number";
        novoinput1[contador].id="yvertice"+(numvertices-contador); //Colando id nos inputs
        novoinput2[contador].id="xvertice"+(numvertices-contador);
        novoinput1[contador].classList.add("yvertice"); //Colocando classe nos inputs caso queira estilizar de uma maneira diferente depois 
        novoinput2[contador].classList.add("xvertice");
        novacoluna2.appendChild(novoinput1[contador]); //Aqui eu to anexando o input no campo do meio 
        novacoluna1.innerHTML = "- Ordenada 'y' do vértice "+(numvertices-contador) //Aqui fica a descrição do campo 
        novacoluna3.innerHTML = "cm" //Aqui fica a unidade 
        novacoluna5.appendChild(novoinput2[contador]); //Aqui eu to anexando o input no campo do meio 
        novacoluna4.innerHTML = "- Abcissa 'x' do vértice  "+(numvertices-contador) //Aqui fica a descrição do campo 
        novacoluna6.innerHTML = "cm" //Aqui fica a unidade
    }
}

function addelemento2() {
    let tabela = document.getElementById('tabela1');

    //Elimina elementos do número de barras quando troca os dados
    let verifica = !!document.getElementById('xbarra1');
    if(verifica ==true){
        var contar = 2;
    }
    while(!!document.getElementById('xbarra'+contar)==true){
        contar++;
    }
    for(let numdelete = 0; numdelete<2*(contar-1); numdelete++){
        document.getElementById('tabela1').deleteRow(tabela.rows.length-10);
    }


    let numbarras = Number(document.getElementById('ns').value);
    let repeticoes2 = numbarras;
    let contarlinha = tabela.rows.length;

    for (let contador=0;contador<repeticoes2;contador++){

        //Inserindo 2 linhas a cada repetição
        let novalinha3 = tabela.insertRow(contarlinha-9);
        let novalinha4 = tabela.insertRow(contarlinha-9);

        //Inserindo as Células 
        let novacoluna1 = novalinha3.insertCell(0);
        let novacoluna2 = novalinha3.insertCell(1);
        let novacoluna3 = novalinha3.insertCell(2);

        let novacoluna4 = novalinha4.insertCell(0);
        let novacoluna5 = novalinha4.insertCell(1);
        let novacoluna6 = novalinha4.insertCell(2);

        let novoinput3 =[];
        let novoinput4=[];

        novoinput3[contador] = document.createElement("input");
        novoinput4[contador] = document.createElement("input");

        novoinput3[contador].type = "number";
        novoinput4[contador].type = "number";

        novoinput3[contador].id="ybarra"+(numbarras-contador); //Adicinando Id
        novoinput4[contador].id="xbarra"+(numbarras-contador);


        //Adicionando classe
        novoinput3[contador].classList.add("barras");
        novoinput4[contador].classList.add("xbarras");

        novacoluna2.appendChild(novoinput3[contador]); //Aqui eu to anexando o input no campo do meio 
        novacoluna1.innerHTML = "- Ordenada 'y' da barra "+(numbarras-contador) //Aqui fica a descrição do campo 
        novacoluna3.innerHTML = "cm" //Aqui fica a unidade 

        novacoluna5.appendChild(novoinput4[contador]); //Aqui eu to anexando o input no campo do meio 
        novacoluna4.innerHTML = "- Abcissa 'x' da barra  "+(numbarras-contador) //Aqui fica a descrição do campo 
        novacoluna6.innerHTML = "cm" //Aqui fica a unidade
    }
}
var clique = 0;

function calcular(){

    var numvertices = Number(document.getElementById('nc').value);
    var repeticoes = numvertices;
    var xvertice=[];
    var yvertice=[];

    for (let contador3=0;contador3<repeticoes;contador3++){
        

        xvertice[contador3] = Number(document.getElementById('xvertice'+(contador3+1)).value);
        yvertice[contador3] = Number(document.getElementById('yvertice'+(contador3+1)).value);
        

    }


    // var pegaverticex = document.getElementsByClassName("xvertice");
    // xvertice=[];
    // var xvertice = pegaverticex.value;


    // console.log(xvertice);
    // console.log(yvertice);
        // Programa para verificação de seções de concreto armado de formato genérico para flexo-compressão oblíqua de acordo com a NBR-6118:2014

    function tensao(es1,esm,fyd) {
    //  Calcula a tensão no aço
    //  es = módulo de elasticidade do aço em kN/cm2
    //  es1 = deformação de entrada
    //  fyd = tensão de escoamento de cálculo em kN/cm2
    //  ss1 = tensão de saída em kN/cm2
    
    // Trabalhando com deformação positiva
    ess = Math.abs(es1)
    eyd = fyd / esm;
    if (ess < eyd) {
        sigmasd = esm * ess
    } else {
        sigmasd = fyd
    }
    // Trocando o sinal se necessário
    if (es1 < 0) {
        sigmasd = -sigmasd
    }
    return sigmasd
    }
    
    function funcao(nsd,qsi,alfa,nc1,xc,yc,alfac,sigmacd,ns,xs,ys,eu,e0,alamb,esm,fyd,astotal) {
    // Calcula o valor da função f(x0)dada na equação (2.5.11) do Volume 3 de Curso de Concreto Armado

    // qsi=x0/h é a profundidade relativa da linha neutra
    // rc é a resultante de compressão do concreto adimensional dada na equação (2.4.4)
    // bc é a posição da resultante adimensional dada na equação (2.4.5)
    // soma1 é o somatório contido no denominador da equação (2.5.9)
    // soma2 é o somatatório contido no denominador da equação (2.5.10)
    // f é o resultado da equação (2.5.11)

    // Todas as variáveis de entrada são públicas     
    // Os parâmetros rc,bc,soma1,soma2,f são calculados nessa sub-rotina

    // Cálculo das coordenadas dos vértices da poligonal segundo o sistema x'o y'
    // paralelo e normal a linha neutra com orientação alfa em relação ao eixo x.

    xl = []
    yl = []

    for (i = 0; i < nc1; i++) {
        xl[i] = xc[i] * Math.cos(alfa) + yc[i] * Math.sin(alfa)
        yl[i] = yc[i] * Math.cos(alfa) - xc[i] * Math.sin(alfa)
    }
    //console.log(xl)
    //console.log(yl)
    // Valores máximo e mínimo de y'
    // Cálculo da altura h da seção

    ylmax = Math.max(...yl)
    ylmin = Math.min(...yl)
    h = Math.abs(ylmax - ylmin)
    
    // Cálculo das coordenadas das armaduras segundo o sistema x'oy'
    // paralelo e normal a linha neutra com orientação alfa em relação ao eixo x.
    // Montagem do vetor Beta(i)=dsi/h
    
     xsl = []
     ysl = []
     beta = []
    for (i = 0; i < ns; i++) {
        xsl[i] = xs[i] * Math.cos(alfa) + ys[i] * Math.sin(alfa)
        ysl[i] = ys[i] * Math.cos(alfa) - xs[i] * Math.sin(alfa)
        beta[i] = Math.abs(ylmax - ysl[i]) / h
    }

    // Valores máximo e mínimo de ys'
    // Cálculo da altura útil d  da seção

    yslmin = Math.min(...ysl)
    d = Math.abs(ylmax - yslmin)
    betamax = d / h

    // Cálculo dos parâmetros qsi e delta

    x0=qsi*h

    // Constantes para o cálculo das deformações das camadas da armadura
    // Observar que o primeiro índice é zero
    q1 = eu * betamax / (eu + 10);
    if (qsi <= q1) {
        // A linha neutra está no domínio 2
        c = 0.01 / (betamax - qsi)
    } else if (qsi<=1) {
        // A linha neutra está nos domínios 3,4 e 4a
        c = eu / (1000 * qsi)
    } else {
        // A linha neutra está no domínio 5
        c = (e0 / 1000) / (qsi - akapa)
    }
    // Resultante de compressão no concreto

    if (alamb * x0 < h) {
        // Seção parcialmente comprimida
        // Coordenada ycl do início da zona de concreto comprimido com o diagrama retangular simplificado
        
        ycl = ylmax - alamb * x0
        kint = 0
        xaux = []
        yaux = []
        for (i = 0; i < nc1; i++) {
            xaux[i] = xl[i]
            yaux[i] = yl[i]
        }
        for (j = 0; j < nc1 - 1; j++) {
            deltaxl=xl[j+1]-xl[j]
            deltayl=yl[j+1]-yl[j]            
            if (Math.abs(deltayl)>=10e-8) {
                xint = xl[j] + (ycl-yl[j]) * deltaxl / deltayl
                if ((xint >= xl[j]) && (xint <= xl[j + 1]) || ((xint <= xl[j]) && (xint >= xl[j + 1]))) {
                    kint += 1
                    nv = nc1 + kint
                    xaux[j + kint] = xint
                    yaux[j + kint] = ycl
                    if (nv >= nc1) {
                        l = j + 1
                        for (k = j + kint + 1; k < nv; k++) { 
                            xaux[k] = xl[l]
                            yaux[k] = yl[l]
                            l++
                        }
                    } else {
                        l = j + 1
                        for (k = j + kint + 1; k < nc1; k++) {
                            xaux[k] = xl[l]
                            yaux[k] = yl[l]
                            l++
                        }
                    }
                }
            nv=nc1+kint
            }
        }
        xl = []
        yl = []
        for (j = 0; j < nv; j++) {
            xl[j] = xaux[j]
            yl[j] = yaux[j]
        }
        
        // Determinação dos vértices da zona de concreto comprimido

        kvc = 0
        xccl = []
        yccl = []
        for (i = 0; i < nv; i++) {
            if (yl[i]>=ycl) {
                xccl[kvc]=xl[i]
                yccl[kvc]=yl[i]
                kvc++
            }
        }
        xccl[kvc] = xccl[0]
        yccl[kvc] = yccl[0]

    // Seção totalmente comprimida
    } else {
        nv = nc1
        kvc = nc1-1
        nvc = kvc
        xccl = []
        yccl = []
        for (i = 0; i < nv; i++) {
        xccl[i] = xl[i]
        yccl[i]  =yl[i]
        }
    }

    nvc = kvc
    xcc = []
    ycc = []
    for (i = 0; i <= nvc; i++) {
        xcc[i] = xccl[i] * Math.cos(alfa) - yccl[i] * Math.sin(alfa)
        ycc[i] = yccl[i] * Math.cos(alfa) + xccl[i] * Math.sin(alfa)
    }
    acc=0.00
    sxc=0.00
    syc=0.00
    xcc[nvc] = xcc[0]
    ycc[nvc] = ycc[0]
    
    for (k = 0; k < nvc; k++) {
        deltaxcc=xcc[k+1]-xcc[k]
        deltaycc=ycc[k+1]-ycc[k]
        acc=acc+1./2.*deltaycc*(2.*xcc[k]+deltaxcc)
        sxc=sxc+1./6.*deltaycc*(3.*xcc[k]*xcc[k+1]+deltaxcc**2)
        syc=syc-1./6.*deltaxcc*(3.*ycc[k]*ycc[k+1]+deltaycc**2)
    }
    // Cálculo das tensões nas armaduras

    somas = 0;
    somasx = 0;
    somasy = 0;

    sigmas = []    
    for (i = 0; i < ns; i++) {
        es1 = c * (qsi - beta[i]);
        sigmas[i]=tensao(es1,esm,fyd);
        somas = somas + astotal/ns * sigmas[i];
        somasx = somasx + astotal/ns * xs[i] * sigmas[i];
        somasy = somasy + astotal/ns * ys[i] * sigmas[i];
    }
    // Esforços resultantes Nrd, Mxrd, Myrd

    nrd=sigmacd*acc+somas
    mxrd=sigmacd*sxc+somasx
    myrd=sigmacd*syc+somasy

    //  Funcao f(x)

    f = nsd - sigmacd * acc - somas

    return [f, nrd, mxrd, myrd]
}

// Entrada de dados

// var nc = 4                                             // Número de vértices da seção de concreto
// nc1 = nc + 1

// var xc = [0, 20, 20, 0]                                 // Abcissa 'x' dos vértices
// var yc = [0, 0, 40, 40]                                // Ordenada 'y' dos vértices



// var xs = [4, 16, 4, 16, 16, 4]                          // Abcissa 'x' das barras
// var ys = [4, 4, 20, 20, 36, 36]                         // Ordenada 'y' das barras
// var astotal = 30                              // Área de aço da seção
// var ns = 6                                              // Número de barras
// var fck = 20 
// var fyk = 500
// var esm = 200                                           // Módulo de elasticidade do aço
// var gamac = 1.4
// var gamas = 1.15
// var gamaf = 1.4                                         //Esforço Solicitante
// var nsk = 800                                           // Esforço normal caracte´ristico
// var mxsk = -1500                                        // Momento fletor em torno de y
// var mysk = 4000  



                                                        // Momento fletor em torno de x
var alfa0 = 0                                           // Valor inicial da inclinaçao da linha neutra
var alfaf = 360                                          // Valor inicial da inclinaçao da linha neutra
var eixox=[];
var eixoy =[];

 var nc = Number(document.getElementById('nc').value);
 var ns = Number(document.getElementById("ns").value);
var astotal = Number(document.getElementById("astotal").value);
var fck = Number(document.getElementById("fck").value);
var fyk = Number(document.getElementById("fyk").value);
var esm = Number(document.getElementById("esm").value);
var gamac = Number(document.getElementById("gamac").value);
var gamas = Number(document.getElementById("gamas").value);
var gamaf = Number(document.getElementById("gamaf").value);
var nsk = Number(document.getElementById("nsk").value);
var mxsk = Number(document.getElementById("mxsk").value);
var mysk = Number(document.getElementById("mysk").value);
nc1 = nc + 1
var xc = [];                          
var yc = [];
for(let contador =0; contador<nc; contador++){
    xc[contador] = Number(document.getElementById('xvertice'+(contador+1)).value);
    yc[contador] = Number(document.getElementById('yvertice'+(contador+1)).value);
 }
 var xs = [];
 var ys = [];
for(let contador = 0; contador<ns;contador++){
    xs[contador] = Number(document.getElementById('xbarra'+(contador+1)).value);
    ys[contador] = Number(document.getElementById('ybarra'+(contador+1)).value);
}

var novoxc = [...xc];
var novoyc = [...yc];
var novoxs = [...xs];
var novoys = [...ys];



// Parâmetros do diagrama retangular
if (fck <= 50) {
    alamb = 0.8;
    alfac = 0.85;
    eu = 3.5;
    e0 = 2;
} else {
    alamb = 0.8 - (fck - 50) / 400;
    alfac = 0.85 * (1 - (fck - 50) / 200);
    a = (90 - fck) / 100;
    eu = 2.6 + 35 * a**4;
    aux = fck - 50;
    a = 0.53;
    e0 = 2 + 0.085 *aux**a
}
// Parâmetro kapa que define o ponto com deformação igual a eo no domínio 5
akapa = 1 - e0 / eu;
           
// Conversão de unidades: transformando para kN e cm
fck = fck / 10;
fyk = fyk / 10;
esm = 100 * esm;
          
// Resistências de cálculo
fcd = fck / gamac;
sigmacd =0.95*alfac * fcd;
fyd = fyk / gamas;

// Esforços solicitantes de cálculo
nsd = gamaf * nsk;
mxsd = gamaf * mxsk;
mysd = gamaf * mysk;

//# Cálculo das coordenadas do centroide da seção de concreto
// Mudança sistema de referência para o centroide da seção de concreto

ac = 0.00
sx = 0.00
sy = 0.00

xc[nc] = xc[0]
yc[nc] = yc[0]
for (i = 0; i < nc; i++) {  
    xi = xc[i]
    yi = yc[i]
    dx = xc[i + 1] - xc[i]
    dy = yc[i + 1] - yc[i]

    ac = ac + (xi + dx / 2.00) * dy
    sx = sx + (xi * (yi + dy / 2.00) + dx * (yi / 2.00 + dy / 3.00)) * dy
    sy = sy + (xi * (xi + dx) + dx ** 2 / 3.00) * dy / 2.00
}
xg = sy / ac
yg = sx / ac
nc1=nc+1
for (i = 0; i < nc1; i++) {  
    
    xc[i]=xc[i]-xg
    yc[i]=yc[i]-yg
}
for (i = 0; i < ns; i++) {  
    xs[i]=xs[i]-xg
    ys[i]=ys[i]-yg
}
// Coordenadas atualizadas para o centroide

// Conversão dos ângulos alfa0 e alfaf para radianos

nalfa = 100
nalfa1 = nalfa + 1
alfa0 = Math.PI / 180 * alfa0
alfaf = Math.PI / 180 * alfaf
deltaalfa = Math.abs(alfaf - alfa0) / nalfa
alfa = -deltaalfa
theta = []
nid = []
mixd = []
miyd = []
k1 = -1

// Variação da inclinação da linha neutra alfa entre alfa0 e alfaf

while (k1 < nalfa) {
    alfa = alfa + deltaalfa
    k1++
    //console.log(`k1 = ${k1}`)
    //console.log(`alfa = ${alfa}`)
    // Processo iterativo da bissecante
    // Determinação do intervalo solução
    // Valor inicial para a linha neutra adminesional qsi=x/h
    qi = 0
    // Chamar sub-rotina para calcular o valor da função fi=f(qi)
    qsi = qi
    teste = funcao(nsd, qsi, alfa, nc1, xc, yc, alfac, sigmacd, ns, xs, ys, eu, e0, alamb, esm, fyd, astotal) 
    fi = teste[0]
    nrd = teste[1]
    mxrd = teste[2]
    myrd = teste[3]
    // Valor final para a linha neutra adimensional qsi=x/h
    qf = 1000;
    // Chamar sub-rotina para calcular o valor da função ff=f(qf)
    qsi = qf;
    teste = funcao(nsd, qsi, alfa, nc1, xc, yc, alfac, sigmacd, ns, xs, ys, eu, e0, alamb, esm, fyd, astotal)  
    ff = teste[0]
    nrd = teste[1]
    mxrd = teste[2]
    myrd = teste[3]    
    prod = fi * ff;
    //  Modificando os extremos do intervalo solução até que prod<=0
    while (prod > 0) {
            
        qi = qf;
        fi = ff;
        qf = 10 * qf;
        qsi = qf;
        teste = funcao(nsd, qsi, alfa, nc1, xc, yc, alfac, sigmacd, ns, xs, ys, eu, e0, alamb, esm, fyd, astotal)
        ff = teste[0]
        nrd = teste[1]
        mxrd = teste[2]
        myrd = teste[3]  
        prod = fi * ff;
    }
    // O intervalo solução foi definido
    // A linha neutra qsi fica entre [qi,qf]

    // O intervalo solução foi definido
    // A linha neutra qsi fica entre [qi,qf]

    // Processo iterativo da bissecante
    fk = 1;
    while (Math.abs(fk) > 0.0001) {

        qk = (qi * ff - qf * fi) / (ff - fi);
        qsi = qk;
        teste = funcao(nsd, qsi, alfa, nc1, xc, yc, alfac, sigmacd, ns, xs, ys, eu, e0, alamb, esm, fyd, astotal)
        fk = teste[0]
        nrd = teste[1]
        mxrd = teste[2]
        myrd = teste[3]
        prod = fk * fi;
        if (prod >= 0) {
            qi = qk;
            fi = fk;
        }else {
            qf = qk;
            ff = fk;
        }
    }
    //  Convergência alcançada
    //  qk é a raiz da função f(qsi) dada na equação (2.5.11) do Volume 3 de Curso de Concreto Armado

    eixox.push(mxrd);
    eixoy.push(myrd);

    

}


if(clique != "0"){ //Verifica quantas vezes o botao calcular foi apertado, se for qualquer numero diferente de 0, essa função ira deletar as duas telas canvas

    //Apagar os elementos antigos
    document.getElementById('crosssection').remove()
    document.getElementById('myChart').remove();
    //Cria elementos novos
    let createcanvas1 = document.createElement('canvas');
    let createcanvas2 = document.createElement('canvas');
    //coloca o id nos elementos
    createcanvas1.id="crosssection";
    createcanvas2.id="myChart";
    //Vincula os elementos no elementos pai
    let ctn1 = document.getElementById('conteiner1');
    let ctn2 = document.getElementById('grafico1');
    ctn1.appendChild(createcanvas1);
    ctn2.appendChild(createcanvas2);
}
clique++;   



//xc e yc para concreto 
//xs e ys para aço

//Pegando os dados la de cima, depois ver com o professor se é isso


var novoxc2 = [...novoxc];
var novoyc2 = [...novoyc];
var novoxs2 = [...novoxs];
var novoys2 = [...novoys];

// Achando a diferenca no eixo x e a diferenca no eixo y
diferencax = Math.max.apply(null, novoxc2)-Math.min.apply(null, novoxc2);
diferencay = Math.max.apply(null, novoyc2)-Math.min.apply(null, novoyc2);


// Desnhando a seção transversal
let canvas = document.getElementById('crosssection');
let ctx1 = canvas.getContext('2d');

//Arrumando os pixels do canvas para ficar com uma resolução descente - inplementar depois
// var stylew = window.getComputedStyle(canvas).width;
// var valor = parseInt(stylew.substr(0,stylew.search("px")));
// canvas.width = valor;


// Descobrindo o meio da div para poder usar como referência do ponto (0,0) do gráfico
let mediax = (Math.max.apply(null, novoxc)+Math.min.apply(null, novoxc))/2;
let mediay = (Math.max.apply(null, novoyc)+Math.min.apply(null, novoyc))/2;
ctx1.translate((canvas.width)/2,(canvas.height)/2);

//Inplemetando a escala dinâmica do desenho para facilitar a visualização
let escala = parseFloat(Math.min((canvas.width-40)/(2*mediax), (canvas.height-40)/(2*mediay))).toFixed(2);

novoxc = novoxc.map(x => escala*(x-(mediax))); //Alinhando o centro do desenho ao centro do gráfico e já colocando escala junto
novoyc = novoyc.map(x => escala*(x-(mediay))); 
novoxs = novoxs.map(x => escala*(x-(mediax)));
novoys = novoys.map(x => escala*(x-(mediay)));

 ctx1.beginPath();
 ctx1.strokeStyle='red';
 ctx1.moveTo(novoxc[0],novoyc[0]);
  
    for (let i = 0; i<nc; i++) {
         ctx1.lineTo(novoxc[i+1],novoyc[i+1]);   
     }
     ctx1.lineTo(novoxc[0],novoyc[0]);
     ctx1.stroke();

    for (i = 0; i < ns; i++) {
        ctx1.beginPath();
        ctx1.strokeStyle="blue";
        ctx1.arc(novoxs[i], novoys[i], 2, 0, Math.PI*2,true);
        ctx1.stroke();
    }
    
//Criando as cotas com base nos valores maximos e minimos, referente aos vértices de concreto
let maxconcx = Math.max.apply(null, novoxc);
let minconcx = Math.min.apply(null, novoxc);
let maxconcy = Math.max.apply(null, novoyc);
let minconcy = Math.min.apply(null, novoyc);

//Criando as linhas das cotas 
ctx1.beginPath();

let distcota = 8; //distancia da cota com relação a extremidade do desenho
let disttracinho = 2; //distância entre a linha principal da cota e a linha auxiliar da cota
let disttexto = 9; //distância entre o texto e a cota

ctx1.moveTo(minconcx-distcota,maxconcy);
ctx1.lineTo(minconcx-(distcota+disttracinho),maxconcy);
ctx1.lineTo(minconcx-(distcota+disttracinho),minconcy);
ctx1.lineTo(minconcx-distcota,minconcy);
ctx1.strokeStyle="brown";
ctx1.stroke();

ctx1.beginPath();
ctx1.moveTo(minconcx,maxconcy+distcota);
ctx1.lineTo(minconcx,maxconcy+distcota+disttracinho);
ctx1.lineTo(maxconcx,maxconcy+distcota+disttracinho);
ctx1.lineTo(maxconcx,maxconcy+distcota);
ctx1.stroke();

ctx1.font="10px Arial black";
let textox = diferencax + ' cm';
let textoy = diferencay + ' cm';

var larguratextox = ctx1.measureText(textox).width;
var larguratextoy = ctx1.measureText(textoy).width;

//Escrevendo os textos das cotas

ctx1.fillText(`${textox}`,-larguratextox/2,maxconcy+distcota+disttracinho+disttexto);
ctx1.rotate(-90*Math.PI/180);
ctx1.fillText(`${textoy}`,-larguratextox/2,minconcx-distcota-2*disttracinho);





// Diagrama de interação da seção

//---------------------------------------------------


//Criação do canva


let ctx2 = document.getElementById('myChart').getContext('2d');
let myChart = new Chart(ctx2, {
    
    data: {
        labels: eixox.reverse(),
        datasets: [{
            type: 'line',
            label: `Nd = ${nsd.toFixed(2)} kN`,
            data: eixoy.reverse(),
            backgroundColor: [
                'rgba(0, 0, 255, 0.4)',   
            ],
            borderColor: [
                'rgba(0, 0, 255, 1)',     
            ],
            borderWidth: 1
         }, {
            type: 'scatter',
            label: "Ponto de projeto",
            data: [{
                x: mysd,
                y: mxsd
            }],
            backgroundColor: [
                'rgba(255, 0, 0, 0.4)',   
            ],
            borderColor: [
                'rgba(255, 0, 0, 1)',     
            ],
            borderWidth: 1
        }
    ]   
    },
    options: {
        aspectRatio:1,
        plugins:{
            legend:{
                position: 'top',
            },
        },
        
        
        scales: {
            
            x:{ 
                grace:function(){
                    let maxx = Math.max(mxsd, ...eixox);  
                    let minx = Math.min(...eixox, mxsd);
                    let maxy = Math.max(mysd, ...eixoy)
                    let miny = Math.min(mysd, ...eixoy);

                    rangex = maxx - minx;
                    rangey = maxy - miny;

                    console.log(rangex,rangey);
                    console.log(rangex > rangey ? 0 : ((Math.abs(rangey)-Math.abs(rangex)))/2)
                    
                    return parseInt(rangex > rangey ? 0 : ((Math.abs(rangey)-Math.abs(rangex)))/2); 
               },
                type: 'linear',
                
                display:true,
                title:{
                    display:true,
                    text:"Mxd",
                },
            },
            y:{ 
                grace:function(){
                    
                    let maxx = Math.max(mxsd, ...eixox);  
                    let minx = Math.min(...eixox, mxsd);
                    let maxy = Math.max(mysd, ...eixoy)
                    let miny = Math.min(mysd, ...eixoy);

                    rangex = maxx - minx;
                    rangey = maxy - miny;

                    console.log(rangex,rangey);
                    

                    return parseInt(rangey > rangex ? 0 : ((Math.abs(rangex)-Math.abs(rangey)))/2); 
                    console.log(rangey > rangex ? 0 : ((Math.abs(rangex)-Math.abs(rangey)))/2);
               },
                display:true,
                //grace: 1000, //Diz qual o valor limite do eixo, se for 1000 por exemplo e o valor máximo for de 800, nesse caso o valor limite do eixo será 1800
                title:{
                    display:true,
                    text:"Myd"
                },
                // ticks:{
                //     stepSize:500,
                    
                // },   
            },
        },
        animation:{
            duration: 1500,
        }, 
    }
    
});

  }


    
    </script>
</body>
</html>